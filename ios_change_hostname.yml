---
- hosts: cisco
  connection: local
  gather_facts: no

  tasks:

  - name: Backup current config
    ios_config:
      backup: yes
    register: backup_config

  - debug:
      var: backup_config.backup_path
      verbosity: 3

  - block:
      - name: Change Hostname
        ios_config:
          lines: hostname {{ new_hostname }}

    rescue:
      - debug:
          var: backup_config.backup_path
          verbosity: 3

      - name: Reset to backed up config
        ios_config:
          src: "{{ backup_config.backup_path }}"
          save: yes
